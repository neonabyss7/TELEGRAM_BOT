# Telegram Бот Witless PRIME

Бот, предоставляющий различные возможности обработки контента и генерации ответов с использованием цепей Маркова.

## Возможности

- Генерация текста на основе цепей Маркова
- Создание мемов из изображений
- Применение эффектов к изображениям (ATMTA, демотиваторы, JPEG-артефакты)
- Импорт и экспорт сообщений
- Работа со стикерами и GIF-анимациями
- Система защиты от спама

## Установка и запуск

### Предварительные требования

- Python 3.8 или выше
- Библиотеки: aiogram, aiosqlite, markovify, pillow

### Установка зависимостей

```bash
pip install aiogram aiosqlite markovify pillow
```

### Конфигурация

Настройте бота, изменив параметры в файле `src/config.py` или используя переменные окружения:

1. `TELEGRAM_BOT_TOKEN` - токен Telegram-бота (получите у @BotFather)
2. `TELEGRAM_ALLOWED_GROUP` - ID группы, где бот будет работать
3. `TELEGRAM_ADMIN_ID` - ID администратора бота

### Запуск бота

```bash
python main.py
```

### Импорт данных (опционально)

Для импорта сообщений из файла:

```bash
python upload_data.py /путь/к/файлу.txt
```

## Доступные команды

### Основные команды

- `/gm` - генерация случайного сообщения с использованием цепей Маркова
- `/story` - генерация истории из нескольких предложений
- `/if` - импорт сообщений из текстового файла
- `/sst` - отправка случайного стикера из базы данных
- `/sg` - отправка случайной GIF-анимации из базы данных
- `/mem` - создание мема из изображения и текста
- `/at` - создание зеркального эффекта ATMTA
- `/dem` - создание демотиватора
- `/jp` - добавление JPEG-артефактов к изображению
- `/help` - отображение справки по доступным командам
- `/stats` - отображение статистики базы данных

### Административные команды

- `/exp` - экспорт всех сообщений из базы данных
- `/adduser` - добавление пользователя в список разрешенных
- `/deluser` - удаление пользователя из списка разрешенных
- `/help2` - отображение справки по административным командам
- `/mr` - обновление цепей Маркова в реальном времени

## Структура проекта

- `main.py` - главный файл для запуска бота
- `upload_data.py` - скрипт для импорта данных из текстового файла
- `src/` - основная директория с кодом
  - `config.py` - файл конфигурации
  - `database/` - код для работы с базой данных
  - `handlers/` - обработчики команд и сообщений
  - `utils/` - вспомогательные утилиты
  - `logs/` - директория для логов

## Решение проблем

### Шрифты на локальной машине

Если возникают проблемы с обработкой изображений и шрифтами:

1. Встроенный резервный шрифт с поддержкой кириллицы будет использоваться автоматически.
2. Если вы хотите использовать определенный шрифт, убедитесь, что он поддерживает кириллицу и установлен в системе.

### Проблемы с базой данных

Перед первым запуском убедитесь, что директория `data/` существует:

```bash
mkdir -p data
```

### Конфликты при запуске нескольких экземпляров

Telegram API не позволяет одновременно получать обновления из нескольких экземпляров бота с одним токеном. Если при запуске получаете ошибку "Conflict: terminated by other getUpdates request", это означает, что уже запущен другой экземпляр бота с тем же токеном.

